# noti 開発TODO

## 1. 認証基盤の実装 (Authentication)

- [x] API Token認証の実装
  - [x] 設定ファイル（`~/.noti/config.json`）の実装
  - [x] トークンの保存と読み込み
  - [x] エラー時の自動リセット機能
  - [x] 接続テスト機能（users.me APIの利用）

## 2. コア機能の実装 (Core Features)

### 2.1 基本的なAPI通信

- [x] Notion APIクライアントの実装
  - [x] @notionhq/clientの導入
  - [x] エラーハンドリング
- [x] 共通機能の実装
  - [x] レスポンスの型定義
  - [x] エラー型の定義
  - [x] 結果のフォーマット処理

### 2.2 ファイル出力

- [x] 出力オプション（-o）の実装
  - [x] JSONフォーマット出力
  - [x] Markdownフォーマット出力
  - [x] stdout/stderrの適切な使い分け

## 3. コマンドの実装 (Commands)

### 3.1 設定関連

- [x] `noti configure` - 設定管理
  - [x] APIトークンの設定
  - [x] 設定のリセット
  - [x] 設定の表示

### 3.2 ページ操作

- [x] `noti page get` - ページ取得
  - [x] ページプロパティの取得
  - [x] ページコンテンツの取得（ブロック）
  - [x] Markdownへの変換
- [x] `noti page append` - ページ追加
  - [x] Markdownからブロックへの変換
  - [x] コンテンツの追加API
- [x] `noti page remove` - ページ削除
- [x] `noti page update` - ページ更新

### 3.3 データベース操作

- [x] `noti database create` - DB作成
  - [x] スキーマ定義の処理
  - [x] プロパティタイプの検証
  - [ ] インタラクティブなウィザード形式での作成
  - [ ] よく使うプロパティテンプレートの保存と再利用
- [x] `noti database update` - DB更新
  - [x] プロパティの追加/削除
  - [x] プロパティの名前変更
  - [x] プロパティの型変更
- [ ] `noti database view` - ビュー操作
  - [ ] カスタムビューの保存
  - [ ] 保存したビューの適用
  - [ ] ビュー一覧の表示
- [ ] `noti database export` - エクスポート
  - [ ] CSV/JSON/Markdownフォーマット
  - [ ] ページコンテンツの含有オプション
- [ ] `noti database import` - インポート
  - [ ] 各種フォーマットからのインポート
  - [ ] 既存エントリの更新オプション
- [x] `noti database add` - エントリー追加
  - [x] プロパティ値の検証
  - [x] 必須項目チェック
- [x] `noti database remove` - エントリー削除
- [x] `noti database search` - DB内検索

### 3.3.1 データベースページ操作

- [x] `noti database page add` - ページ追加
- [x] `noti database page get` - ページ取得
- [x] `noti database page remove` - ページ削除
- [x] `noti database page update` - ページ更新
  - [x] 個別プロパティの更新
  - [x] JSONファイルからの一括更新
  - [x] インタラクティブな更新UI
- [x] `noti database page copy` - ページコピー
  - [x] 別データベースへのコピー
  - [x] コンテンツを含めたコピー
- [x] `noti database page link` - ページの関連付け
  - [x] リレーションプロパティの設定
  - [x] 複数ページの一括関連付け
- [x] `noti database page list` - ページ一覧
  - [x] カスタムビューでの表示
  - [x] ソート・フィルター機能
- [x] `noti database page move` - ページ移動
  - [x] 別データベースへの移動
  - [x] プロパティマッピング

### 3.4 検索機能

- [x] `noti search` - グローバル検索
  - [x] fzfライクなTUIの実装
  - [x] 検索結果の表示と選択
- [x] インタラクティブナビゲーション
  - [x] ツリー表示の実装
  - [x] キーボードショートカット

## 4. ユーティリティ機能

### 4.1 Markdown変換

- [x] Notion → Markdown変換
  - [x] 各ブロックタイプの変換ルール
  - [x] リッチテキスト要素の処理
- [x] Markdown → Notionブロック変換
  - [x] 基本的なMarkdown要素の変換
  - [x] 未サポート要素の処理

### 4.2 エラーハンドリング

- [x] エラータイプの定義
  - [x] 認証エラー
  - [x] 接続エラー
  - [x] バリデーションエラー
- [x] エラーメッセージの多言語対応
- [x] デバッグモードの実装

## 5. テスト

- [x] 単体テスト
  - [x] 各コマンドのテスト
  - [x] Markdown変換のテスト
  - [x] エラーケースのテスト
- [x] 統合テスト
  - [x] 実際のAPIとの通信テスト
  - [x] エンドツーエンドテスト
- [x] モックテスト
  - [x] API応答のモック
  - [x] ファイルシステムのモック

## 6. ドキュメント

- [x] README.mdの作成
  - [x] インストール手順
  - [x] 基本的な使い方
  - [x] コマンドリファレンス
- [ ] APIドキュメント
  - [ ] TypeDocの設定
  - [ ] 関数とクラスのドキュメント
- [ ] エラーハンドリングガイド

## 7. CI/CD

- [ ] GitHub Actionsの設定
  - [ ] テストの自動実行
  - [ ] リリースの自動化
- [ ] バージョニング管理
- [ ] パッケージ公開の自動化

## 8. 完了した変更点（2024-02-13）

1. 認証方式の簡素化
   - OAuthフローを削除し、APIトークン方式に変更
   - 設定ファイルの構造を単純化
   - エラー時の自動リセット機能を追加

2. 基本的な設定管理の実装
   - `~/.noti/config.json`による設定の永続化
   - 初回起動時のセットアップフロー
   - 接続テスト機能の実装

## 実装済み

- [x] Notion APIトークンの設定
- [x] ページの取得（JSON/Markdown）
- [x] ページへのコンテンツ追加
- [x] ページの作成
  - [x] 親ページの指定（ID/URL）
  - [x] タイトルの指定方法
    - [x] `--title`オプションで直接指定
    - [x] Markdownの最初の`#`から抽出
    - [x] ファイル名から自動設定
  - [x] Markdownファイルからの本文変換
- [x] デバッグモードの実装
- [x] ファイル出力オプション
- [x] エイリアス機能の実装
- [x] ファジー検索機能の実装

## 優先度の高い未実装タスク

1. データベース作成の改善
   - [ ] インタラクティブなデータベース作成ウィザード
     - [ ] プロパティタイプの選択UI
     - [ ] プロパティ設定のバリデーション
     - [ ] プレビュー機能
   - [ ] プロパティテンプレートの管理
     - [ ] テンプレートの保存
     - [ ] テンプレートの編集
     - [ ] テンプレートの適用

2. データベース操作の拡張
   - [ ] データベースのカスタムビュー
     - [ ] ビューの保存
     - [ ] ビューの適用
   - [ ] バッチ処理機能
     - [ ] 複数エントリーの一括追加
     - [ ] 一括更新
