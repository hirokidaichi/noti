# noti 開発TODO

## 1. 認証基盤の実装 (Authentication)

- [x] API Token認証の実装
  - [x] 設定ファイル（`~/.noti/config.json`）の実装
  - [x] トークンの保存と読み込み
  - [x] エラー時の自動リセット機能
  - [x] 接続テスト機能（users.me APIの利用）

## 2. コア機能の実装 (Core Features)

### 2.1 基本的なAPI通信
- [x] Notion APIクライアントの実装
  - [x] @notionhq/clientの導入
  - [x] エラーハンドリング
- [ ] 共通機能の実装
  - [ ] レスポンスの型定義
  - [ ] エラー型の定義
  - [ ] 結果のフォーマット処理

### 2.2 ファイル出力
- [x] 出力オプション（-o）の実装
  - [x] JSONフォーマット出力
  - [x] Markdownフォーマット出力
  - [x] stdout/stderrの適切な使い分け

## 3. コマンドの実装 (Commands)

### 3.1 設定関連
- [x] `noti configure` - 設定管理
  - [x] APIトークンの設定
  - [x] 設定のリセット
  - [ ] 設定の表示

### 3.2 ページ操作
- [x] `noti page get` - ページ取得
  - [x] ページプロパティの取得
  - [x] ページコンテンツの取得（ブロック）
  - [x] Markdownへの変換
- [x] `noti page append` - ページ追加
  - [x] Markdownからブロックへの変換
  - [x] コンテンツの追加API
- [ ] `noti page remove` - ページ削除
- [ ] `noti page update` - ページ更新

### 3.3 データベース操作
- [ ] `noti database create` - DB作成
  - [ ] スキーマ定義の処理
  - [ ] プロパティタイプの検証
- [ ] `noti database add` - エントリー追加
  - [ ] プロパティ値の検証
  - [ ] 必須項目チェック
- [ ] `noti database remove` - エントリー削除
- [ ] `noti database search` - DB内検索

### 3.4 検索機能
- [ ] `noti search` - グローバル検索
  - [ ] fzfライクなTUIの実装
  - [ ] 検索結果の表示と選択
- [ ] インタラクティブナビゲーション
  - [ ] ツリー表示の実装
  - [ ] キーボードショートカット

## 4. ユーティリティ機能

### 4.1 Markdown変換
- [ ] Notion → Markdown変換
  - [ ] 各ブロックタイプの変換ルール
  - [ ] リッチテキスト要素の処理
- [ ] Markdown → Notionブロック変換
  - [ ] 基本的なMarkdown要素の変換
  - [ ] 未サポート要素の処理

### 4.2 エラーハンドリング
- [x] エラータイプの定義
  - [x] 認証エラー
  - [x] 接続エラー
  - [ ] バリデーションエラー
- [ ] エラーメッセージの多言語対応
- [x] デバッグモードの実装

## 5. テスト

- [ ] 単体テスト
  - [ ] 各コマンドのテスト
  - [ ] Markdown変換のテスト
  - [ ] エラーケースのテスト
- [ ] 統合テスト
  - [ ] 実際のAPIとの通信テスト
  - [ ] エンドツーエンドテスト
- [ ] モックテスト
  - [ ] API応答のモック
  - [ ] ファイルシステムのモック

## 6. ドキュメント

- [ ] README.mdの作成
  - [ ] インストール手順
  - [ ] 基本的な使い方
  - [ ] コマンドリファレンス
- [ ] APIドキュメント
  - [ ] TypeDocの設定
  - [ ] 関数とクラスのドキュメント
- [ ] エラーハンドリングガイド

## 7. CI/CD

- [ ] GitHub Actionsの設定
  - [ ] テストの自動実行
  - [ ] リリースの自動化
- [ ] バージョニング管理
- [ ] パッケージ公開の自動化

## 8. 完了した変更点（2024-02-13）

1. 認証方式の簡素化
   - OAuthフローを削除し、APIトークン方式に変更
   - 設定ファイルの構造を単純化
   - エラー時の自動リセット機能を追加

2. 基本的な設定管理の実装
   - `~/.noti/config.json`による設定の永続化
   - 初回起動時のセットアップフロー
   - 接続テスト機能の実装

## 実装済み

- [x] Notion APIトークンの設定
- [x] ページの取得（JSON/Markdown）
- [x] ページへのコンテンツ追加
- [x] ページの作成
  - [x] 親ページの指定（ID/URL）
  - [x] タイトルの指定方法
    - [x] `--title`オプションで直接指定
    - [x] Markdownの最初の`# `から抽出
    - [x] ファイル名から自動設定
  - [x] Markdownファイルからの本文変換
- [x] デバッグモードの実装
- [x] ファイル出力オプション

## 未実装

- [ ] ページの削除
- [ ] ページの更新（上書き）
- [ ] データベースの操作
  - [ ] データベースの作成
  - [ ] データベースの取得
  - [ ] データベースへのページ追加
- [ ] 双方向同期
  - [ ] ローカルのMarkdownファイルをNotionに反映
  - [ ] Notionの変更をローカルに反映 