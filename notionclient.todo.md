# Notion Client テスト計画

## 1. テストの再構成

### 1.1 ディレクトリ構造の整理

- [ ] テストディレクトリの再構成
  ```
  e2e/
  ├── notion-client/           # Notion Client専用のテスト
  │   ├── database.test.ts     # データベース操作
  │   ├── page.test.ts         # ページ操作
  │   ├── block.test.ts        # ブロック操作
  │   ├── comment.test.ts      # コメント操作
  │   ├── search.test.ts       # 検索機能
  │   └── setup.ts             # テスト用セットアップ
  └── commands/                # CLIコマンドのE2Eテスト
      └── ...
  ```

### 2.4 高度な機能

- [ ] バッチ操作
  - [ ] 複数ページの一括作成
  - [ ] 複数ページの一括更新
- [ ] リレーション
  - [ ] 単一リレーション
  - [ ] 双方向リレーション
- [ ] ロールアップ
  - [ ] 数値計算
  - [ ] 日付計算
- [ ] フォーミュラ
  - [ ] 基本演算
  - [ ] 条件分岐
  - [ ] 日付操作

## 3. ページ操作のテスト強化

### 3.1 基本操作

- [x] ページの作成
  - [x] タイトル設定
  - [x] プロパティ設定
  - [x] 親ページ指定
- [x] ページの更新
  - [x] プロパティ更新
  - [x] アーカイブ/復元
- [x] ページの削除

### 3.2 ブロック操作

- [x] ブロックの追加
  - [x] 各種ブロックタイプ
  - [x] ネストされたブロック
- [x] ブロックの更新
- [x] ブロックの削除
- [x] ブロックの移動

## 4. その他の機能テスト

### 4.1 コメント機能

- [x] コメントの追加
- [x] コメントの取得
- [x] コメントの削除

### 4.2 検索機能

- [x] ページ検索
  - [x] 基本的な検索機能
  - [x] オブジェクトタイプによるフィルタリング
  - [x] ページネーション
- [x] データベース検索
  - [x] 基本的な検索機能
  - [x] オブジェクトタイプによるフィルタリング
- [x] フィルター付き検索
  - [x] オブジェクトタイプによるフィルタリング
  - [x] ページサイズの制御
  - [x] カーソルベースのページネーション

## 5. 非機能要件のテスト

### 5.1 パフォーマンス

- [ ] 大量データの処理
  - [ ] 大規模データベースのクエリ
  - [ ] 多数のブロックを持つページの操作
- [ ] API制限への対応
  - [ ] レート制限の考慮
  - [ ] バックオフ戦略

### 5.2 エラーハンドリング

- [x] 無効なUUID形式
- [x] 存在しないページ/ブロック
- [ ] ネットワークエラー
- [ ] タイムアウト
- [ ] 認証エラー
- [ ] API制限エラー

### 5.3 セキュリティ

- [ ] トークン管理
- [ ] アクセス権限の検証

## 6. テストユーティリティの整備

### 6.1 テストヘルパー

- [ ] モックデータ生成
- [ ] テストフィクスチャー
- [ ] アサーション関数

### 6.2 テスト環境

- [ ] テスト用データベーステンプレート
- [ ] クリーンアップ処理
- [ ] 並列実行対応

## データベース操作の拡張

### エラーケース

- [x] 無効なプロパティ設定
- [x] 無効な型定義
- [x] 必須プロパティの欠落
- [x] アクセス権限エラー
- [x] 存在しないデータベース/ページ
- [x] APIリミットエラー
